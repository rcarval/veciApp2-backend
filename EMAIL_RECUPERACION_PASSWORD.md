# ğŸ“§ Email HTML de RecuperaciÃ³n de ContraseÃ±a

## âœ… ImplementaciÃ³n Completada

Se creÃ³ un email HTML hermoso para el cÃ³digo de recuperaciÃ³n de contraseÃ±a que se envÃ­a cuando un usuario olvida su contraseÃ±a.

---

## ğŸ¨ DiseÃ±o del Email

### CaracterÃ­sticas Visuales
- âœ… **Logo real de VeciApp** (servido desde backend)
- âœ… **CÃ³digo de 6 dÃ­gitos destacado** con fuente monospace
- âœ… **Gradiente de fondo** en la secciÃ³n del cÃ³digo
- âœ… **Warning de expiraciÃ³n** (5 minutos)
- âœ… **Consejos de seguridad**
- âœ… **Instrucciones paso a paso**
- âœ… **Responsive** (mÃ³vil y desktop)

---

## ğŸ“§ Vista Previa del Email

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Gradiente Verde-Morado]                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚  LOGO   â”‚ VeciApp                            â”‚
â”‚  â”‚  REAL   â”‚ Tu comunidad, mÃ¡s conectada        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Hola Juan! ğŸ”

  Has solicitado restablecer tu contraseÃ±a en VeciApp.

  Usa el siguiente cÃ³digo de verificaciÃ³n de 6 dÃ­gitos 
  en la aplicaciÃ³n:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  TU CÃ“DIGO DE VERIFICACIÃ“N        â”‚
  â”‚                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚  â”‚                             â”‚ â”‚
  â”‚  â”‚        123456               â”‚ â”‚ â† Grande, en color verde
  â”‚  â”‚                             â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  âš ï¸ Este cÃ³digo expirarÃ¡ en 5 minutos

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ğŸ›¡ï¸ Seguridad:                     â”‚
  â”‚ â€¢ No compartas este cÃ³digo        â”‚
  â”‚ â€¢ Si no lo solicitaste, ignÃ³ralo  â”‚
  â”‚ â€¢ Tu contraseÃ±a sigue siendo      â”‚
  â”‚   vÃ¡lida hasta que la cambies     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Pasos a seguir:
  1ï¸âƒ£ Ingresa el cÃ³digo de 6 dÃ­gitos en la app
  2ï¸âƒ£ Crea una nueva contraseÃ±a segura
  3ï¸âƒ£ Inicia sesiÃ³n con tu nueva contraseÃ±a

  Si no solicitaste restablecer tu contraseÃ±a, 
  puedes ignorar este correo de forma segura.

  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
         VeciApp
    Tu comunidad, mÃ¡s conectada
      Â© 2025 VeciApp
```

---

## ğŸ”§ ImplementaciÃ³n TÃ©cnica

### Archivo: `src/utils/emailTemplates.js`

**Nueva funciÃ³n:**
```javascript
emailRecuperacionPassword({ nombre, codigo })
```

**CaracterÃ­sticas del cÃ³digo:**
```css
font-size: 48px;
font-weight: 900;
color: #2A9D8F;
letter-spacing: 12px;
font-family: 'Courier New', monospace;
text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
```

### Archivo: `src/routes/auth.js`

**Endpoint modificado:**
```javascript
POST /api/auth/recuperar-password
```

**Antes:**
```javascript
await sendMail({
  to: usuario.correo,
  subject: 'CÃ³digo de recuperaciÃ³n de contraseÃ±a',
  text: `Tu cÃ³digo es: ${codigo}. Expira en 5 minutos.`
})
```

**Ahora:**
```javascript
const htmlContent = emailRecuperacionPassword({
  nombre: usuario.nombre,
  codigo
})

await sendMail({
  to: usuario.correo,
  subject: 'ğŸ” CÃ³digo de recuperaciÃ³n de contraseÃ±a - VeciApp',
  text: `[versiÃ³n texto plano]`,
  html: htmlContent
})
```

---

## ğŸ“± Flujo Completo

### 1. Usuario Olvida ContraseÃ±a
```
App â†’ RecuperarPasswordScreen
Usuario ingresa: juan@ejemplo.com
Presiona: "Enviar CÃ³digo"
```

### 2. Backend Genera CÃ³digo
```
CÃ³digo aleatorio: 6 dÃ­gitos (100000-999999)
Expira en: 5 minutos
Se guarda en: usuarios.codigo_verificacion
```

### 3. Usuario Recibe Email
```
Asunto: ğŸ” CÃ³digo de recuperaciÃ³n de contraseÃ±a - VeciApp
CÃ³digo: 123456 (destacado en grande)
Logo: Real de VeciApp
```

### 4. Usuario Ingresa CÃ³digo
```
App â†’ VerificarCodigoScreen
Usuario ingresa: 123456
Backend valida: cÃ³digo + expiraciÃ³n
```

### 5. Usuario Cambia ContraseÃ±a
```
App â†’ CambiarPasswordScreen
Nueva contraseÃ±a: ********
Confirmar: ********
âœ… ContraseÃ±a actualizada
```

---

## â° Tiempo de ExpiraciÃ³n

**Backend:** 5 minutos
```javascript
const expira = new Date(Date.now() + 5*60*1000)
```

**Frontend (RecuperarPasswordScreen):**
```jsx
<Text>El cÃ³digo expira en 5 minutos</Text>
```

**Email:**
```
â° Este cÃ³digo expirarÃ¡ en 5 minutos
```

**Todo sincronizado en 5 minutos** âœ…

---

## ğŸ›¡ï¸ Seguridad Implementada

### 1. CÃ³digo Aleatorio
```javascript
Math.floor(100000 + Math.random()*900000).toString()
// Genera: 100000 - 999999 (6 dÃ­gitos)
```

### 2. ExpiraciÃ³n AutomÃ¡tica
- Se guarda en `fecha_expiracion_codigo`
- Backend valida antes de aceptar
- CÃ³digo invÃ¡lido despuÃ©s de 5 minutos

### 3. Respuesta GenÃ©rica
```javascript
// Siempre retorna el mismo mensaje (seguridad)
let okMsg = { 
  mensaje: 'Si el correo existe, recibirÃ¡s un cÃ³digo...' 
}
```

### 4. Un Solo Uso
- Se elimina despuÃ©s de cambiar contraseÃ±a
- No se puede reutilizar

### 5. Consejos en Email
```
â€¢ No compartas este cÃ³digo con nadie
â€¢ Si no lo solicitaste, ignÃ³ralo
â€¢ Tu contraseÃ±a actual sigue siendo vÃ¡lida
```

---

## ğŸ“ Cambios Adicionales

### RegisterScreen.js
âœ… **Eliminado input de telÃ©fono**
- Ya no es obligatorio
- Formulario mÃ¡s simple
- Menos fricciÃ³n en registro

**Antes:**
```jsx
<TextInput
  placeholder="+56912345678"
  value={telefono}
  onChangeText={setTelefono}
  keyboardType="phone-pad"
/>
```

**Ahora:**
```
(Eliminado completamente)
```

**Backend:**
```javascript
// Ya era opcional, ahora solo no se envÃ­a desde frontend
const { telefono } = req.body || {}
// Si no viene, se guarda como NULL
```

---

## ğŸ§ª Probar el Sistema

### Paso 1: Solicitar CÃ³digo
```
1. Abre la app VeciApp
2. Ve a "Â¿Olvidaste tu contraseÃ±a?"
3. Ingresa tu correo: test@ejemplo.com
4. Presiona "Enviar CÃ³digo"
5. VerÃ¡s: "Si el correo existe, recibirÃ¡s un cÃ³digo..."
```

### Paso 2: Revisar Email
```
1. Ve a Mailtrap (https://mailtrap.io)
2. Abre el inbox
3. VerÃ¡s email: "ğŸ” CÃ³digo de recuperaciÃ³n de contraseÃ±a"
4. CÃ³digo destacado en grande: 123456
5. Logo real de VeciApp
```

### Paso 3: Verificar CÃ³digo
```
1. La app te lleva a VerificarCodigoScreen
2. Ingresa el cÃ³digo: 123456
3. Presiona "Verificar"
4. Si es correcto: Te lleva a cambiar contraseÃ±a
5. Si expirÃ³ o es incorrecto: Error
```

### Paso 4: Cambiar ContraseÃ±a
```
1. Ingresa nueva contraseÃ±a: NewPass123
2. Confirma: NewPass123
3. Presiona "Cambiar ContraseÃ±a"
4. âœ… ContraseÃ±a actualizada
5. Inicia sesiÃ³n con la nueva contraseÃ±a
```

---

## ğŸ“Š ComparaciÃ³n: Antes vs Ahora

| Aspecto | âŒ Antes | âœ… Ahora |
|---------|---------|---------|
| **DiseÃ±o Email** | Texto plano | HTML hermoso con logo |
| **CÃ³digo** | PequeÃ±o | Grande, destacado, monospace |
| **Logo** | No | SÃ­, logo real de VeciApp |
| **Seguridad** | Tips bÃ¡sicos | SecciÃ³n completa de seguridad |
| **Instrucciones** | No | Paso a paso numerado |
| **Responsive** | No aplica | Funciona en mÃ³vil y desktop |
| **TelÃ©fono** | Obligatorio en registro | Opcional (eliminado) |

---

## ğŸ¨ CÃ³digo CSS del Email

### Caja del CÃ³digo
```css
background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
border-radius: 16px;
padding: 30px;
margin: 30px 0;
text-align: center;
```

### CÃ³digo de 6 DÃ­gitos
```css
background: white;
border-radius: 12px;
padding: 25px;
box-shadow: 0 4px 15px rgba(0,0,0,0.1);
font-size: 48px;
font-weight: 900;
color: #2A9D8F;
letter-spacing: 12px;
font-family: 'Courier New', monospace;
```

---

## ğŸ“ Archivos Modificados

### Backend
- âœ… `src/utils/emailTemplates.js` - Nueva plantilla
- âœ… `src/routes/auth.js` - Usa plantilla HTML

### Frontend  
- âœ… `screens/RecuperarPasswordScreen.js` - Actualizado a 5 minutos
- âœ… `screens/RegisterScreen.js` - Eliminado input de telÃ©fono

---

## âœ¨ PrÃ³ximas Mejoras Opcionales

1. **Contador de intentos:** Bloquear despuÃ©s de 3 intentos fallidos
2. **Reenviar cÃ³digo:** BotÃ³n para solicitar nuevo cÃ³digo
3. **Historial:** Log de intentos de recuperaciÃ³n
4. **NotificaciÃ³n:** Email cuando se cambia la contraseÃ±a
5. **2FA:** OpciÃ³n de autenticaciÃ³n de dos factores

---

**Sistema de recuperaciÃ³n de contraseÃ±a con emails HTML hermosos completamente operativo** ğŸ‰âœ…

